<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Get Started | BinPals</title>

  <!-- Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="shared.css">

  <script src="site.js" defer></script>

  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --panel-2:#f8fafc;
      --text:#0f172a;
      --muted:#475569;
      --brand:#16a34a;
      --brand-dark:#15803d;
      --accent:#0ea5e9;
      --stroke:rgba(15,23,42,.08);
      --shadow:0 32px 70px rgba(15,23,42,.08);
      --radius:28px;
      --radius-sm:16px;
      --gap: clamp(20px, 2.5vw, 36px);
      --container: 1140px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%; display:block}
    .container{max-width:var(--container);margin:0 auto;padding:0 clamp(16px,3vw,32px)}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px; padding:12px 24px; border-radius:999px; font-weight:700; font-size:15px;
      border:0; color:#fff; background:var(--brand);
      box-shadow:none; cursor:pointer;
      transition:.2s ease;
    }
    .btn:hover{background:var(--brand-dark); transform:translateY(-1px)}
    .btn:disabled{opacity:.5; cursor:not-allowed; transform:none}
    .btn-secondary{
      background:#e2e8f0;
      color:#0f172a;
      border:0;
    }
    .btn-secondary:hover{background:#cbd5f5; color:#0f172a; transform:none}

    section{padding: clamp(88px, 8vw, 144px) 0}
    .center{text-align:center}
    .form-hero{background:#fff; position:relative; overflow:hidden; border-bottom:1px solid rgba(15,23,42,.08); padding:0;}
    .form-hero .container{
      max-width:none;
      padding: clamp(56px,8vw,112px) clamp(16px,6vw,120px) clamp(88px,9vw,128px);
    }
    .form-intro{
      max-width:var(--container);
      margin:0 auto clamp(32px,5vw,60px);
    }
    .form-hero::before{display:none}
    .form-hero .lead{color:var(--muted); max-width:720px; margin:12px auto 0}

    .visually-hidden{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      border:0;
    }

    .form-shell{
      width:100%;
      display:flex;
      justify-content:center;
    }

    .form-card{
      width:min(100%, 760px);
      background:rgba(248,250,252,.92);
      border-radius:32px;
      border:1px solid rgba(148,163,184,.22);
      box-shadow:0 32px 80px rgba(15,23,42,.12);
      padding: clamp(28px,4vw,48px);
      position:relative;
      overflow:hidden;
      display:grid;
      gap: clamp(24px,3vw,36px);
    }
    .form-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      pointer-events:none;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.6);
    }
    .form-card.is-complete{padding: clamp(44px,5vw,64px);}
    .form-card.is-complete .progress{display:none}
    form{display:grid; gap:28px; position:relative}

    .progress{display:grid; gap:18px}
    .progress-rail{
      height:6px; border-radius:999px; background:rgba(148,163,184,.24); position:relative;
      overflow:hidden;
    }
    .progress-fill{
      position:absolute; inset:0 auto 0 0; height:100%; width:0%; border-radius:999px;
      background:linear-gradient(90deg, var(--brand), #0ea5e9);
      transition:width .35s ease;
    }
    .progress-steps{
      list-style:none; margin:0; padding:0; display:flex; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
    }
    .progress-steps li{
      display:flex; align-items:center; gap:10px; color:var(--muted); font-size:13px; font-weight:600;
      padding:8px 12px;
      border-radius:14px;
      background:rgba(148,163,184,.12);
      transition:.25s ease;
    }
    .progress-steps .circle{
      width:30px; height:30px; border-radius:50%; border:2px solid transparent;
      display:flex; align-items:center; justify-content:center; font-weight:700; font-size:14px;
      background:#fff; box-shadow:0 8px 18px rgba(15,23,42,.08);
    }
    .progress-steps li.is-active{color:var(--text); background:#fff; box-shadow:0 14px 30px rgba(15,23,42,.08)}
    .progress-steps li.is-active .circle{
      border-color:transparent; background:var(--brand); color:#fff; box-shadow:0 16px 32px rgba(34,197,94,.25);
    }

    .complete-state{display:none; text-align:center; gap:20px; justify-items:center}
    .complete-icon{
      width:72px; height:72px; border-radius:24px;
      background:rgba(22,163,74,.12);
      display:grid; place-items:center;
      color:var(--brand);
      box-shadow:0 20px 40px rgba(34,197,94,.18);
    }
    .complete-icon svg{width:34px; height:34px}
    .complete-state h2{margin:8px 0 0; font-size:clamp(26px,3vw,32px)}
    .complete-state p{margin:0; color:var(--muted); max-width:440px; line-height:1.6}
    .complete-actions{display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:12px}
    .complete-actions .btn{min-width:180px}
    .form-card.is-complete .complete-state{display:grid}
    .form-card.is-complete form{display:none}
    .form-card.is-complete .form-alerts{display:none}

    .form-alerts{display:grid; gap:12px}

    .steps{display:grid; gap:16px}
    .step{
      display:none;
    }
    .step.is-active{display:block; animation:fadeUp .35s ease}

    @keyframes fadeUp{
      from{opacity:0; transform:translateY(12px)}
      to{opacity:1; transform:translateY(0)}
    }

    .step-card{
      background:#fff;
      border-radius:24px;
      border:1px solid rgba(148,163,184,.22);
      box-shadow:0 18px 44px rgba(15,23,42,.08);
      padding: clamp(22px,3vw,32px);
      display:grid;
      gap: clamp(18px,2.5vw,26px);
    }
    .step-card h3{margin:0; font-size:20px; color:#0f172a}

    .field-grid{
      display:grid;
      gap:16px;
    }
    @media(min-width:680px){
      .field-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }

    .input-control{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .input-label{
      font-size:13px;
      font-weight:600;
      color:#334155;
      letter-spacing:.01em;
    }
    .field{
      background:#fff;
      border:1px solid rgba(15,23,42,.12);
      border-radius:16px;
      width:100%;
      padding:14px 16px;
      font:inherit;
      color:var(--text);
      outline:none;
      transition:border-color .18s ease, box-shadow .18s ease;
      box-shadow:0 10px 24px rgba(15,23,42,.05);
    }
    .field:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 4px rgba(14,165,233,.15);
    }
    select.field{
      appearance:none;
      background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"%3E%3Cpath d="M4.47 5.97a.75.75 0 0 1 1.06 0L8 8.44l2.47-2.47a.75.75 0 1 1 1.06 1.06L8.53 9.53a.75.75 0 0 1-1.06 0L4.47 7.03a.75.75 0 0 1 0-1.06Z" fill="%230f172a"/%3E%3C/svg%3E');
      background-repeat:no-repeat;
      background-position:right 16px center;
      padding-right:42px;
    }
    .select-help{font-size:12px; color:var(--muted)}

    .step-footer{display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap}
    .step-footer .btn{min-width:140px}
    .step-footer .spacer{flex:1 1 auto}

    .link-button{
      border:0;
      background:transparent;
      color:var(--accent);
      font-weight:600;
      font-size:14px;
      text-decoration:underline;
      padding:0;
      justify-self:start;
      cursor:pointer;
    }
    .link-button:hover{opacity:.8}

    .plan-card{
      display:grid;
      gap:16px;
      border:1px solid rgba(148,163,184,.22);
      border-radius:22px;
      padding:22px;
      background:#fff;
      box-shadow:0 14px 34px rgba(15,23,42,.08);
    }
    @media(min-width:600px){
      .plan-card{grid-template-columns:auto 1fr; align-items:center}
    }
    .plan-visual{
      width:96px; height:96px; border-radius:26px;
      background:linear-gradient(135deg, rgba(34,197,94,.18), rgba(14,165,233,.12));
      display:grid; place-items:center; overflow:hidden;
      box-shadow:0 16px 32px rgba(14,165,233,.16);
    }
    .plan-visual img{width:96px; height:96px; object-fit:cover}
    .plan-title{margin:0; font-size:18px}
    .plan-price{margin:6px 0 8px; font-weight:700; color:var(--brand-dark)}
    .plan-copy{color:var(--muted); margin:0; line-height:1.5; font-size:14px}
    .plan-features{list-style:none; margin:12px 0 0; padding:0; display:grid; gap:8px; color:var(--text); font-size:14px}
    .plan-features li{display:flex; gap:8px; align-items:flex-start}
    .plan-features li::before{
      content:""; width:6px; height:6px; border-radius:50%; background:var(--brand); margin-top:6px;
    }

    .summary{
      border:1px solid rgba(148,163,184,.22);
      border-radius:22px;
      padding:22px;
      background:#fff;
      display:grid;
      gap:18px;
      box-shadow:0 18px 40px rgba(15,23,42,.06);
    }
    .summary-group{display:grid; gap:10px}
    .summary-row{display:flex; justify-content:space-between; gap:18px; color:var(--text); font-size:14px}
    .summary-row span{color:var(--muted); font-weight:500}
    .summary-row strong{text-align:right}
    .summary-plan{display:grid; gap:12px}
    .summary-plan .plan-card{margin:0; box-shadow:none}

    .checkbox-control{
      display:flex;
      align-items:flex-start;
      gap:12px;
      font-size:14px;
      color:var(--text);
    }
    .checkbox-control input{
      margin-top:2px;
      width:20px;
      height:20px;
      border-radius:6px;
    }

    .notice{
      display:none;
      margin:0;
      padding:16px 20px;
      border-radius:18px;
      border:1px solid rgba(34,197,94,.28);
      background:#ecfdf5;
      color:#166534;
      font-weight:500;
    }
    .notice.error{
      border-color:rgba(248,113,113,.35);
      background:#fef2f2;
      color:#991b1b;
    }
    .notice.show{display:block}

    @media(max-width:599px){
      .plan-card{grid-template-columns:1fr}
    }
  </style>
</head>
<body data-header-cta="solid">

  <div data-include="partials/header.html"></div>

  <main>
    <section class="form-hero">
      <div class="container">
        <div class="form-intro center">
          <h1 class="visually-hidden">BinPals Service Request</h1>
          <h2>Get Started in Peoria</h2>
          <p class="lead">Tell us where you live and how many bins you have. We’ll match you with the right plan and confirm your pickup days.</p>
        </div>

        <div class="form-shell">
          <div class="form-card" data-form-card>
            <div class="complete-state" data-complete-state hidden role="status">
              <div class="complete-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.25 12a8.25 8.25 0 1 1-16.5 0 8.25 8.25 0 0 1 16.5 0Z" stroke="currentColor" stroke-width="1.5"/><path d="m9.25 12.25 1.75 1.75 3.75-3.75" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <h2>Request received</h2>
              <p>Thanks! Your request is on its way. A BinPals coordinator will reach out shortly to confirm your clean.</p>
              <div class="complete-actions">
                <a class="btn" href="index.html">Back to home</a>
                <button type="button" class="btn btn-secondary" data-restart>Submit another request</button>
              </div>
            </div>
            <form id="serviceForm" novalidate data-form-body>
              <div class="progress">
                <div class="progress-rail" aria-hidden="true">
                  <div class="progress-fill" data-progress-fill></div>
                </div>
                <ol class="progress-steps">
                  <li data-progress-item="0" class="is-active"><span class="circle">1</span>Basic info</li>
                  <li data-progress-item="1"><span class="circle">2</span>Bin counts</li>
                  <li data-progress-item="2"><span class="circle">3</span>Plan preview</li>
                  <li data-progress-item="3"><span class="circle">4</span>Confirm</li>
                </ol>
              </div>

              <input type="hidden" name="recommended_plan" id="recommendedPlan">
              <input type="hidden" name="plan_price" id="planPrice">

              <div class="form-alerts">
                <div id="formError" class="notice error" role="alert">Oops! Something went wrong. Please try again or email <a href="mailto:hello@binpals.com">hello@binpals.com</a>.</div>
              </div>

              <div class="steps">
                <div class="step" data-step-index="0" aria-hidden="false">
                  <div class="step-card">
                    <h3>Basic info</h3>
                    <div class="field-grid">
                      <label class="input-control">
                        <span class="input-label">Full name</span>
                        <input class="field" type="text" name="name" placeholder="First and last" autocomplete="name" data-step-required>
                      </label>
                      <label class="input-control">
                        <span class="input-label">Email</span>
                        <input class="field" type="email" name="email" placeholder="you@email.com" autocomplete="email" data-step-required>
                      </label>
                      <label class="input-control">
                        <span class="input-label">Mobile number</span>
                        <input class="field" type="tel" name="phone" placeholder="(555) 555-5555" autocomplete="tel" data-step-required>
                      </label>
                      <label class="input-control">
                        <span class="input-label">Service address (Peoria, AZ)</span>
                        <input class="field" type="text" name="address" placeholder="Street, City, ZIP" autocomplete="street-address" data-step-required>
                      </label>
                    </div>
                    <div class="step-footer">
                      <button type="button" class="btn btn-secondary" data-prev disabled>Back</button>
                      <span class="spacer"></span>
                      <button type="button" class="btn" data-next>Next</button>
                    </div>
                  </div>
                </div>

                <div class="step" data-step-index="1" aria-hidden="true">
                  <div class="step-card">
                    <h3>Bin counts</h3>
                    <div class="field-grid">
                      <label class="input-control">
                        <span class="input-label">How many trash bins?</span>
                        <select class="field" name="trash_bins" data-bin-select data-step-required>
                          <option value="" disabled selected>Select</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                        </select>
                      </label>
                      <label class="input-control">
                        <span class="input-label">How many recycle bins?</span>
                        <select class="field" name="recycle_bins" data-bin-select data-step-required>
                          <option value="" disabled selected>Select</option>
                          <option value="0">0</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                        </select>
                      </label>
                    </div>
                    <div class="step-footer">
                      <button type="button" class="btn btn-secondary" data-prev>Back</button>
                      <span class="spacer"></span>
                      <button type="button" class="btn" data-next id="binNext" disabled>Next</button>
                    </div>
                  </div>
                </div>

                <div class="step" data-step-index="2" aria-hidden="true">
                  <div class="step-card">
                    <h3>Plan preview</h3>
                    <div class="plan-card" data-plan-card>
                      <div class="plan-visual">
                        <img src="" alt="BinPals plan preview for Peoria, Arizona" data-plan-image hidden>
                      </div>
                      <div>
                        <h4 class="plan-title" data-plan-title>Choose your bin counts to see your match</h4>
                        <p class="plan-price" data-plan-price></p>
                        <p class="plan-copy" data-plan-copy>We’ll suggest the perfect BinPals plan once we know how many cans you set out.</p>
                        <ul class="plan-features" data-plan-features></ul>
                        <button type="button" class="link-button" data-change-plan hidden>Switch plan</button>
                      </div>
                    </div>
                    <div class="step-footer">
                      <button type="button" class="btn btn-secondary" data-prev>Back</button>
                      <span class="spacer"></span>
                      <button type="button" class="btn" data-next id="confirmBtn" disabled>Next</button>
                    </div>
                  </div>
                </div>

                <div class="step" data-step-index="3" aria-hidden="true">
                  <div class="step-card">
                    <h3>Confirm</h3>
                    <div class="summary">
                      <div class="summary-plan">
                        <div class="plan-card" data-summary-plan>
                          <div class="plan-visual">
                            <img src="" alt="BinPals selected plan summary for Peoria, Arizona" data-summary-plan-image hidden>
                          </div>
                          <div>
                            <h4 class="plan-title" data-summary-plan-title>Recommended plan</h4>
                            <p class="plan-price" data-summary-plan-price></p>
                            <p class="plan-copy" data-summary-plan-copy></p>
                            <ul class="plan-features" data-summary-plan-features></ul>
                          </div>
                        </div>
                      </div>
                      <div class="summary-group" data-summary></div>
                    </div>

                    <label class="checkbox-control">
                      <input type="checkbox" name="peoria_confirm" value="yes" data-step-required>
                      <span>I confirm service is in Peoria, AZ or nearby.</span>
                    </label>

                    <div class="step-footer">
                      <button type="button" class="btn btn-secondary" data-prev>Back</button>
                      <span class="spacer"></span>
                      <button type="submit" class="btn">Submit request</button>
                    </div>
                  </div>
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div data-include="partials/footer.html"></div>

  <script>
    const form = document.getElementById('serviceForm');
    const steps = Array.from(form.querySelectorAll('[data-step-index]'));
    const progressFill = document.querySelector('[data-progress-fill]');
    const progressItems = document.querySelectorAll('[data-progress-item]');
    const planCard = document.querySelector('[data-plan-card]');
    const planImage = planCard.querySelector('[data-plan-image]');
    const planTitle = planCard.querySelector('[data-plan-title]');
    const planPrice = planCard.querySelector('[data-plan-price]');
    const planCopy = planCard.querySelector('[data-plan-copy]');
    const planFeatures = planCard.querySelector('[data-plan-features]');
    const changePlanBtn = planCard.querySelector('[data-change-plan]');
    const binNextBtn = document.getElementById('binNext');
    const confirmBtn = document.getElementById('confirmBtn');
    const summaryWrap = document.querySelector('[data-summary]');
    const summaryPlan = document.querySelector('[data-summary-plan]');
    const summaryPlanImage = summaryPlan.querySelector('[data-summary-plan-image]');
    const summaryPlanTitle = summaryPlan.querySelector('[data-summary-plan-title]');
    const summaryPlanPrice = summaryPlan.querySelector('[data-summary-plan-price]');
    const summaryPlanCopy = summaryPlan.querySelector('[data-summary-plan-copy]');
    const summaryPlanFeatures = summaryPlan.querySelector('[data-summary-plan-features]');
    const errorNotice = document.getElementById('formError');
    const formCardElement = document.querySelector('[data-form-card]');
    const completionState = document.querySelector('[data-complete-state]');
    const restartBtn = document.querySelector('[data-restart]');
    const recommendedPlanInput = document.getElementById('recommendedPlan');
    const planPriceInput = document.getElementById('planPrice');
    const binSelects = Array.from(form.querySelectorAll('[data-bin-select]'));

    let currentStep = 0;

    const planCatalog = {
      starter: {
        name: 'Starter Plan',
        label: 'Starter Plan',
        price: '$39/mo · billed quarterly',
        description: 'Service for up to 2 cans with once-per-week set out and return.',
        features: [
          'Service for up to 2 cans',
          'Weekly valet set out & return',
          'Extra bin add-on available'
        ],
        image: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20120%20120%22%20width%3D%22120%22%20height%3D%22120%22%3E%3Crect%20width%3D%22120%22%20height%3D%22120%22%20rx%3D%2228%22%20fill%3D%22%2322c55e%22/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2254%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2248%22%20font-weight%3D%22700%22%20fill%3D%22%23ffffff%22%3E2%3C/text%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2280%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2218%22%20font-weight%3D%22500%22%20fill%3D%22%23dcfce7%22%3EBins%3C/text%3E%3C/svg%3E'
      },
      premium: {
        name: 'Premium Plan',
        label: 'Premium Plan',
        price: '$54/mo · billed quarterly',
        description: 'Our most popular valet trash plan for up to 4 cans with flexible pickup days.',
        features: [
          'Service for up to 4 cans',
          'Dashboard access for schedule updates',
          'Up to two collection days per week'
        ],
        image: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20120%20120%22%20width%3D%22120%22%20height%3D%22120%22%3E%3Crect%20width%3D%22120%22%20height%3D%22120%22%20rx%3D%2228%22%20fill%3D%22%230ea5e9%22/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2254%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2248%22%20font-weight%3D%22700%22%20fill%3D%22%23ffffff%22%3E4%3C/text%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2280%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2218%22%20font-weight%3D%22500%22%20fill%3D%22%23dcfce7%22%3EBins%3C/text%3E%3C/svg%3E'
      },
      business: {
        name: 'Business Plan',
        label: 'Business Plan',
        price: '$65/mo · billed quarterly',
        description: 'Extended valet support for large households, casitas, and light commercial needs.',
        features: [
          'Service for up to 6 cans',
          'All Premium benefits included',
          'Dedicated point of contact'
        ],
        image: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20120%20120%22%20width%3D%22120%22%20height%3D%22120%22%3E%3Crect%20width%3D%22120%22%20height%3D%22120%22%20rx%3D%2228%22%20fill%3D%22%230f172a%22/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2254%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2248%22%20font-weight%3D%22700%22%20fill%3D%22%23ffffff%22%3E6%3C/text%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2280%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2218%22%20font-weight%3D%22500%22%20fill%3D%22%2394a3b8%22%3EBins%3C/text%3E%3C/svg%3E'
      }
    };

    function determinePlanKey(){
      const trash = parseInt(form.elements.trash_bins.value, 10);
      const recycle = parseInt(form.elements.recycle_bins.value, 10);
      if(Number.isNaN(trash) || Number.isNaN(recycle)){
        return null;
      }
      const total = trash + recycle;
      if(total <= 2){
        return 'starter';
      }
      if(total <= 4){
        return 'premium';
      }
      return 'business';
    }

    function updateProgress(){
      const percent = (currentStep / (steps.length - 1)) * 100;
      progressFill.style.width = `${percent}%`;
      progressItems.forEach((item, index)=>{
        item.classList.toggle('is-active', index <= currentStep);
      });
    }

    function updateRequirements(){
      steps.forEach((step, index)=>{
        const requiredFields = step.querySelectorAll('[data-step-required]');
        requiredFields.forEach(field=>{
          if(index === currentStep){
            field.setAttribute('required','');
            if(field.type !== 'checkbox'){
              field.removeAttribute('aria-invalid');
            }
          }else{
            field.removeAttribute('required');
          }
        });
      });
    }

    function showStep(index, options = {}){
      const { scrollToTop = true } = options;
      currentStep = index;
      steps.forEach((step, i)=>{
        const isActive = i === index;
        step.setAttribute('aria-hidden', String(!isActive));
        step.classList.toggle('is-active', isActive);
      });
      updateProgress();
      updateRequirements();
      if(index === 2){
        updatePlanCard();
      }
      if(index === 3){
        renderSummary();
      }
      if(scrollToTop){
        window.scrollTo({top:0, behavior:'smooth'});
      }
    }

    function validateStep(index){
      const step = steps[index];
      const requiredFields = Array.from(step.querySelectorAll('[data-step-required]'));
      for(const field of requiredFields){
        if(field.type === 'radio'){
          const group = step.querySelectorAll(`input[type="radio"][name="${field.name}"]`);
          const isChecked = Array.from(group).some(radio => radio.checked);
          if(!isChecked){
            field.setCustomValidity('Please select an option.');
            field.reportValidity();
            field.setCustomValidity('');
            return false;
          }
        }else if(field.type === 'checkbox'){
          if(!field.checked){
            field.setCustomValidity('Please confirm to continue.');
            field.reportValidity();
            field.setCustomValidity('');
            return false;
          }
        }else if(field.tagName === 'SELECT'){
          if(!field.value){
            field.setCustomValidity('Please choose an option.');
            field.reportValidity();
            field.setCustomValidity('');
            return false;
          }
        }else{
          if(!field.checkValidity()){
            field.reportValidity();
            return false;
          }
        }
      }
      return true;
    }

    function nextStep(){
      if(!validateStep(currentStep)) return;
      if(currentStep < steps.length - 1){
        showStep(currentStep + 1);
      }
    }

    function prevStep(){
      if(currentStep > 0){
        showStep(currentStep - 1);
      }
    }

    form.querySelectorAll('[data-next]').forEach(btn=>{
      btn.addEventListener('click', nextStep);
    });
    form.querySelectorAll('[data-prev]').forEach(btn=>{
      btn.addEventListener('click', prevStep);
    });

    function updateBinStepState(){
      const planKey = determinePlanKey();
      const selectsComplete = binSelects.every(select => select.value !== '');
      binNextBtn.disabled = !selectsComplete || !planKey;
      confirmBtn.disabled = !planKey;
    }

    function updatePlanCard(){
      const planKey = determinePlanKey();
      updateBinStepState();
      if(changePlanBtn){
        changePlanBtn.hidden = true;
      }
      if(!planKey){
        planTitle.textContent = 'Choose your bin counts to see your match';
        planPrice.textContent = '';
        planCopy.textContent = 'We’ll suggest the perfect BinPals plan once we know how many cans you set out.';
        planFeatures.innerHTML = '';
        planImage.hidden = true;
        recommendedPlanInput.value = '';
        planPriceInput.value = '';
        return;
      }
      const plan = planCatalog[planKey];
      if(!plan){
        confirmBtn.disabled = true;
        return;
      }
      planTitle.textContent = plan.label;
      planPrice.textContent = plan.price;
      planCopy.textContent = plan.description;
      planFeatures.innerHTML = plan.features.map(item => `<li>${item}</li>`).join('');
      planImage.src = plan.image;
      planImage.alt = `${plan.name} icon`;
      planImage.hidden = false;
      if(changePlanBtn){
        changePlanBtn.hidden = false;
      }
      confirmBtn.disabled = false;
      recommendedPlanInput.value = plan.name;
      planPriceInput.value = plan.price;
    }

    function renderSummary(){
      const trash = form.elements.trash_bins.value;
      const recycle = form.elements.recycle_bins.value;
      const planKey = determinePlanKey();
      const plan = planKey ? planCatalog[planKey] : null;
      const rows = [
        {label: 'Name', value: form.elements.name.value},
        {label: 'Email', value: form.elements.email.value},
        {label: 'Mobile', value: form.elements.phone.value},
        {label: 'Service address', value: form.elements.address.value},
        {label: 'Trash bins', value: trash ? `${trash}` : ''},
        {label: 'Recycle bins', value: recycle ? `${recycle}` : ''}
      ];
      summaryWrap.innerHTML = rows
        .filter(row => row.value)
        .map(row => `<div class="summary-row"><span>${row.label}</span><strong>${row.value}</strong></div>`)
        .join('');

      if(plan){
        summaryPlanTitle.textContent = plan.label;
        summaryPlanPrice.textContent = plan.price;
        summaryPlanCopy.textContent = plan.description;
        summaryPlanFeatures.innerHTML = plan.features.map(item => `<li>${item}</li>`).join('');
        summaryPlanImage.src = plan.image;
        summaryPlanImage.alt = `${plan.name} icon`;
        summaryPlanImage.hidden = false;
      }else{
        summaryPlanTitle.textContent = 'Recommended plan';
        summaryPlanPrice.textContent = '';
        summaryPlanCopy.textContent = '';
        summaryPlanFeatures.innerHTML = '';
        summaryPlanImage.hidden = true;
      }
    }

    binSelects.forEach(select=>{
      select.addEventListener('change', ()=>{
        updatePlanCard();
      });
    });

    changePlanBtn && changePlanBtn.addEventListener('click', ()=>{
      showStep(1);
    });

    function resetWizard(){
      form.reset();
      binNextBtn.disabled = true;
      confirmBtn.disabled = true;
      showStep(0, {scrollToTop:false});
      updatePlanCard();
      errorNotice.classList.remove('show');
    }

    function showCompletion(){
      if(completionState){
        completionState.removeAttribute('hidden');
      }
      if(formCardElement){
        formCardElement.classList.add('is-complete');
        window.scrollTo({top:formCardElement.offsetTop - 40, behavior:'smooth'});
      }
    }

    function hideCompletion(){
      if(completionState){
        completionState.setAttribute('hidden','');
      }
      if(formCardElement){
        formCardElement.classList.remove('is-complete');
      }
    }

    restartBtn && restartBtn.addEventListener('click', ()=>{
      hideCompletion();
      resetWizard();
      const firstField = form.querySelector('input[name="name"]');
      firstField && firstField.focus();
    });

    function prefillFromQuery(){
      const params = new URLSearchParams(window.location.search);
      let hasPrefill = false;
      const simpleFields = ['name','email','phone','address'];
      simpleFields.forEach(fieldName => {
        if(params.has(fieldName)){
          const value = params.get(fieldName);
          if(value){
            form.elements[fieldName].value = value;
            hasPrefill = true;
          }
        }
      });
      if(params.has('bin_count')){
        const count = parseInt(params.get('bin_count'), 10);
        if(!Number.isNaN(count) && count > 0){
          const trashValue = Math.min(Math.max(count, 1), 4);
          const recycleValue = Math.min(Math.max(count - trashValue, 0), 3);
          form.elements.trash_bins.value = String(trashValue);
          form.elements.recycle_bins.value = String(recycleValue);
          hasPrefill = true;
        }
      }
      if(hasPrefill && 'replaceState' in history){
        history.replaceState(null, '', window.location.pathname);
      }
      updatePlanCard();
    }

    prefillFromQuery();
    showStep(0, {scrollToTop:false});
    updatePlanCard();

    form.addEventListener('submit', async (event)=>{
      event.preventDefault();
      errorNotice.classList.remove('show');

      if(!validateStep(3)){
        return;
      }

      const formData = new FormData(form);
      try{
        const response = await fetch('https://formspree.io/f/xgvpgrqg', {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: formData
        });

        if(response.ok){
          resetWizard();
          showCompletion();
        }else{
          errorNotice.classList.add('show');
        }
      }catch(error){
        console.error(error);
        errorNotice.classList.add('show');
      }
    });
  </script>
</body>
</html>
