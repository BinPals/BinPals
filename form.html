<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Get Started | BinPals</title>

  <!-- Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="shared.css">

  <script src="site.js" defer></script>

  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --panel-2:#f8fafc;
      --text:#0f172a;
      --muted:#475569;
      --brand:#16a34a;
      --brand-dark:#15803d;
      --accent:#0ea5e9;
      --stroke:rgba(15,23,42,.08);
      --shadow:0 32px 70px rgba(15,23,42,.08);
      --radius:28px;
      --radius-sm:16px;
      --gap: clamp(20px, 2.5vw, 36px);
      --container: 1140px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%; display:block}
    .container{max-width:var(--container);margin:0 auto;padding:0 clamp(16px,3vw,32px)}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px; padding:12px 24px; border-radius:999px; font-weight:700; font-size:15px;
      border:0; color:#fff; background:var(--brand);
      box-shadow:none; cursor:pointer;
      transition:.2s ease;
    }
    .btn:hover{background:var(--brand-dark); transform:translateY(-1px)}
    .btn:disabled{opacity:.5; cursor:not-allowed; transform:none}
    .btn--ghost{
      background:transparent;
      color:#fff;
      border:2px solid rgba(255,255,255,.5);
      box-shadow:none;
    }
    .btn--ghost:hover{background:rgba(255,255,255,.12)}
    .btn-secondary{
      background:#e2e8f0;
      color:#0f172a;
      border:0;
    }
    .btn-secondary:hover{background:#cbd5f5; color:#0f172a; transform:none}

    section{padding: clamp(88px, 8vw, 144px) 0}
    .center{text-align:center}
    .form-hero{background:#fff; position:relative; overflow:hidden; border-bottom:1px solid rgba(15,23,42,.08); padding:0;}
    .form-hero .container{
      max-width:none;
      padding: clamp(56px,8vw,112px) clamp(16px,6vw,120px) clamp(88px,9vw,128px);
    }
    .form-intro{
      max-width:var(--container);
      margin:0 auto clamp(32px,5vw,60px);
    }
    .form-hero::before{display:none}
    .form-hero .lead{color:var(--muted); max-width:720px; margin:12px auto 0}

    .form-card{
      margin:0;
      max-width:none;
      width:100%;
      background:var(--panel);
      border-radius:var(--radius);
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      padding: clamp(32px,4vw,52px);
      position:relative;
      overflow:hidden;
      display:grid;
      gap: clamp(28px,3vw,42px);
    }
    .form-shell{
      width:100%;
    }
    .form-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      pointer-events:none;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.6);
    }
    .form-card.is-complete{padding: clamp(44px,5vw,64px);}
    .form-card.is-complete .progress{display:none}
    form{display:grid; gap:32px; position:relative}
    label{display:block; font-weight:600; font-size:15px}
    .field{
      margin-top:10px;
      background:#fff;
      border:1px solid rgba(15,23,42,.08);
      border-radius:16px;
      width:100%;
      padding:16px 18px;
      font:inherit;
      color:var(--text);
      outline:none;
      transition:border-color .18s ease, box-shadow .18s ease;
      box-shadow:0 10px 30px rgba(15,23,42,.04);
    }
    .field:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 4px rgba(14,165,233,.15);
    }
    textarea.field{min-height:120px; resize:vertical}

    .progress{display:grid; gap:18px}
    .progress-rail{
      height:6px; border-radius:999px; background:rgba(148,163,184,.24); position:relative;
      overflow:hidden;
    }
    .progress-fill{
      position:absolute; inset:0 auto 0 0; height:100%; width:0%; border-radius:999px;
      background:linear-gradient(90deg, var(--brand), #0ea5e9);
      transition:width .35s ease;
    }
    .progress-steps{
      list-style:none; margin:0; padding:0; display:flex; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
    }
    .progress-steps li{
      display:flex; align-items:center; gap:12px; color:var(--muted); font-size:14px; font-weight:600;
      padding:10px 14px;
      border-radius:16px;
      background:rgba(148,163,184,.12);
      transition:.25s ease;
    }
    .progress-steps .circle{
      width:34px; height:34px; border-radius:50%; border:2px solid transparent;
      display:flex; align-items:center; justify-content:center; font-weight:700; font-size:15px;
      background:#fff; box-shadow:0 10px 22px rgba(15,23,42,.08);
    }
    .progress-steps li.is-active{color:var(--text); background:rgba(22,163,74,.12)}
    .progress-steps li.is-active .circle{
      border-color:transparent; background:var(--brand); color:#fff; box-shadow:0 16px 32px rgba(34,197,94,.35);
    }

    .complete-state{display:none; text-align:center; gap:20px; justify-items:center}
    .complete-icon{
      width:72px; height:72px; border-radius:24px;
      background:rgba(22,163,74,.12);
      display:grid; place-items:center;
      color:var(--brand);
      box-shadow:0 20px 40px rgba(34,197,94,.18);
    }
    .complete-icon svg{width:34px; height:34px}
    .complete-state h2{margin:8px 0 0; font-size:clamp(26px,3vw,32px)}
    .complete-state p{margin:0; color:var(--muted); max-width:440px; line-height:1.6}
    .complete-actions{display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:12px}
    .complete-actions .btn{min-width:180px}
    .form-card.is-complete .complete-state{display:grid}
    .form-card.is-complete form{display:none}
    .form-card.is-complete .form-alerts{display:none}

    .form-alerts{display:grid; gap:12px}

    .steps{position:relative}
    .step{
      display:none;
      gap:22px;
    }
    .step[aria-hidden="false"]{display:grid; animation:fadeUp .35s ease}

    @keyframes fadeUp{
      from{opacity:0; transform:translateY(12px)}
      to{opacity:1; transform:translateY(0)}
    }

    .grid{display:grid; gap:20px}
    @media(min-width:720px){
      .grid.two{grid-template-columns:1fr 1fr}
    }

    .option-list{display:grid; gap:16px}
    .option-card{
      position:relative;
      border:1px solid rgba(15,23,42,.08);
      border-radius:20px;
      padding:22px 24px;
      display:grid;
      gap:8px;
      transition:.25s ease;
      cursor:pointer;
      background:#fff;
      box-shadow:0 18px 34px rgba(15,23,42,.05);
    }
    .option-card:hover{border-color:rgba(14,165,233,.45); box-shadow:0 20px 44px rgba(14,165,233,.14)}
    .option-card input{position:absolute; inset:0; opacity:0; pointer-events:none}
    .option-title{font-weight:700; font-size:17px}
    .option-desc{color:var(--muted); font-size:14px}
    .option-card.is-selected{
      border-color:rgba(34,197,94,.4);
      background:linear-gradient(135deg, rgba(34,197,94,.1), rgba(14,165,233,.08));
      box-shadow:0 24px 48px rgba(34,197,94,.2);
    }
    .option-card.is-selected .option-title{color:var(--brand-dark)}

    .plan-card{
      display:grid;
      gap:20px;
      border:1px solid rgba(15,23,42,.08);
      border-radius:22px;
      padding:26px;
      background:#fff;
      box-shadow:0 20px 46px rgba(15,23,42,.08);
    }
    @media(min-width:640px){
      .plan-card{grid-template-columns:auto 1fr; align-items:center}
    }
    .plan-visual{
      width:120px; height:120px; border-radius:30px;
      background:linear-gradient(135deg, rgba(34,197,94,.18), rgba(14,165,233,.12));
      display:grid; place-items:center; overflow:hidden;
      box-shadow:0 18px 40px rgba(14,165,233,.16);
    }
    .plan-visual img{width:120px; height:120px; object-fit:cover}
    .plan-title{margin:0; font-size:22px}
    .plan-price{margin:6px 0 12px; font-weight:700; color:var(--brand-dark)}
    .plan-copy{color:var(--muted); margin:0 0 16px; line-height:1.5}
    .plan-features{list-style:none; margin:0; padding:0; display:grid; gap:10px; color:var(--text); font-size:14px}
    .plan-features li{display:flex; gap:10px; align-items:flex-start}
    .plan-features li::before{
      content:""; width:8px; height:8px; border-radius:50%; background:var(--brand); margin-top:7px;
    }

    .step-footer{display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap}
    .step-footer .btn{min-width:140px}
    .step-footer .spacer{flex:1 1 auto}

    .summary{
      border:1px solid rgba(15,23,42,.08);
      border-radius:22px;
      padding:24px;
      background:#fff;
      display:grid;
      gap:18px;
      box-shadow:0 18px 40px rgba(15,23,42,.06);
    }
    .summary-group{display:grid; gap:6px}
    .summary-row{display:flex; justify-content:space-between; gap:18px; color:var(--text); font-size:15px}
    .summary-row span{color:var(--muted); font-weight:500}
    .summary-row strong{text-align:right}
    .summary-plan{display:grid; gap:12px}
    .summary-plan .plan-price{margin-top:0}

    .notice{
      display:none;
      margin:0;
      padding:16px 20px;
      border-radius:18px;
      border:1px solid rgba(34,197,94,.28);
      background:#ecfdf5;
      color:#166534;
      font-weight:500;
    }
    .notice.error{
      border-color:rgba(248,113,113,.35);
      background:#fef2f2;
      color:#991b1b;
    }
    .notice.show{display:block}

  </style>
</head>
<body data-header-cta="solid">

  <div data-include="partials/header.html"></div>

  <main>
    <section class="form-hero">
      <div class="container">
        <div class="form-intro center">
          <h1>Schedule your BinPals clean in minutes</h1>
          <p class="lead">Tell us a little about your home and how many bins you have. We’ll recommend the perfect plan and route your request straight to our crew.</p>
        </div>

        <div class="form-shell">
          <div class="form-card" data-form-card>
          <div class="complete-state" data-complete-state hidden role="status">
            <div class="complete-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.25 12a8.25 8.25 0 1 1-16.5 0 8.25 8.25 0 0 1 16.5 0Z" stroke="currentColor" stroke-width="1.5"/><path d="m9.25 12.25 1.75 1.75 3.75-3.75" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <h2>Request received</h2>
            <p>Thanks! Your request is on its way. A BinPals coordinator will reach out shortly to confirm your clean.</p>
            <div class="complete-actions">
              <a class="btn" href="index.html">Back to home</a>
              <button type="button" class="btn btn-secondary" data-restart>Submit another request</button>
            </div>
          </div>
          <form id="serviceForm" novalidate data-form-body>
            <div class="progress">
              <div class="progress-rail" aria-hidden="true">
                <div class="progress-fill" data-progress-fill></div>
              </div>
              <ol class="progress-steps">
                <li data-progress-item="0" class="is-active"><span class="circle">1</span>Basic info</li>
                <li data-progress-item="1"><span class="circle">2</span>Bin count</li>
                <li data-progress-item="2"><span class="circle">3</span>Recommended plan</li>
                <li data-progress-item="3"><span class="circle">4</span>Review &amp; submit</li>
              </ol>
            </div>

            <input type="hidden" name="recommended_plan" id="recommendedPlan">
            <input type="hidden" name="plan_price" id="planPrice">

            <div class="form-alerts">
              <div id="formError" class="notice error" role="alert">Oops! Something went wrong. Please try again or email <a href="mailto:hello@binpals.com">hello@binpals.com</a>.</div>
            </div>

            <div class="steps">
              <div class="step" data-step-index="0" aria-hidden="false">
                <div class="grid two">
                  <label>Full name
                    <input class="field" type="text" name="name" placeholder="First &amp; last" data-step-required>
                  </label>
                  <label>Email address
                    <input class="field" type="email" name="email" placeholder="you@email.com" autocomplete="email" data-step-required>
                  </label>
                </div>
                <div class="grid two">
                  <label>Mobile phone
                    <input class="field" type="tel" name="phone" placeholder="(555) 555-5555" autocomplete="tel" data-step-required>
                  </label>
                  <label>Service address
                    <input class="field" type="text" name="address" placeholder="Street, City, ZIP" autocomplete="street-address" data-step-required>
                  </label>
                </div>

                <div class="step-footer">
                  <button type="button" class="btn btn-secondary" data-prev disabled>Back</button>
                  <span class="spacer"></span>
                  <button type="button" class="btn" data-next>Next</button>
                </div>
              </div>

              <div class="step" data-step-index="1" aria-hidden="true">
                <div>
                  <h2 style="margin:0 0 12px">How many bins do you need cleaned?</h2>
                  <p style="margin:0 0 24px; color:var(--muted);">Pick the range that matches your curbside trash and recycle cans. We’ll tailor the visit length and crew.</p>
                  <div class="option-list" role="radiogroup" aria-label="Select bin range">
                    <label class="option-card">
                      <input type="radio" name="bin_range" value="1-2" data-step-required>
                      <span class="option-title">1 – 2 bins</span>
                      <span class="option-desc">Perfect for small households or part-time residents.</span>
                    </label>
                    <label class="option-card">
                      <input type="radio" name="bin_range" value="3-4" data-step-required>
                      <span class="option-title">3 – 4 bins</span>
                      <span class="option-desc">Great for families with trash, recycle, and yard bins.</span>
                    </label>
                    <label class="option-card">
                      <input type="radio" name="bin_range" value="5-6" data-step-required>
                      <span class="option-title">5 – 6 bins</span>
                      <span class="option-desc">Ideal for casitas, HOAs, and light commercial spaces.</span>
                    </label>
                  </div>
                </div>

                <div class="step-footer">
                  <button type="button" class="btn btn-secondary" data-prev>Back</button>
                  <span class="spacer"></span>
                  <button type="button" class="btn" data-next id="toPlan" disabled>Next</button>
                </div>
              </div>

              <div class="step" data-step-index="2" aria-hidden="true">
                <div class="plan-card" data-plan-card>
                  <div class="plan-visual">
                    <img src="" alt="" data-plan-image hidden>
                  </div>
                  <div>
                    <h2 class="plan-title" data-plan-title>Choose how many bins you have first</h2>
                    <p class="plan-price" data-plan-price></p>
                    <p class="plan-copy" data-plan-copy>Once you pick your bin count, we’ll show the BinPals package that keeps your cans sparkling on schedule.</p>
                    <ul class="plan-features" data-plan-features></ul>
                  </div>
                </div>
                <p style="margin:12px 0 0; color:var(--muted);">Want a different cadence? Tap back to change your bin range—each option updates instantly.</p>

                <div class="step-footer">
                  <button type="button" class="btn btn-secondary" data-prev>Back</button>
                  <span class="spacer"></span>
                  <button type="button" class="btn" data-next id="reviewBtn" disabled>Review</button>
                </div>
              </div>

              <div class="step" data-step-index="3" aria-hidden="true">
                <div class="summary">
                  <div class="summary-plan">
                    <div class="plan-card" style="margin:0" data-summary-plan>
                      <div class="plan-visual">
                        <img src="" alt="" data-summary-plan-image hidden>
                      </div>
                      <div>
                        <h3 class="plan-title" data-summary-plan-title>Recommended plan</h3>
                        <p class="plan-price" data-summary-plan-price></p>
                        <p class="plan-copy" data-summary-plan-copy></p>
                        <ul class="plan-features" data-summary-plan-features></ul>
                      </div>
                    </div>
                  </div>
                  <div class="summary-group" data-summary></div>
                </div>

                <label>Notes for the crew (gate code, pets, etc.)
                  <textarea class="field" name="notes" placeholder="Optional"></textarea>
                </label>

                <div class="step-footer">
                  <button type="button" class="btn btn-secondary" data-prev>Back</button>
                  <span class="spacer"></span>
                  <button type="submit" class="btn">Submit request</button>
                </div>
              </div>
            </div>

          </form>
        </div>
      </div>
      </div>
    </section>
  </main>

  <div data-include="partials/footer.html"></div>

  <script>
    const form = document.getElementById('serviceForm');
    const steps = Array.from(form.querySelectorAll('[data-step-index]'));
    const progressFill = document.querySelector('[data-progress-fill]');
    const progressItems = document.querySelectorAll('[data-progress-item]');
    const planInputs = Array.from(form.querySelectorAll('input[name="bin_range"]'));
    const planCard = document.querySelector('[data-plan-card]');
    const planImage = planCard.querySelector('[data-plan-image]');
    const planTitle = planCard.querySelector('[data-plan-title]');
    const planPrice = planCard.querySelector('[data-plan-price]');
    const planCopy = planCard.querySelector('[data-plan-copy]');
    const planFeatures = planCard.querySelector('[data-plan-features]');
    const planButtonStep2 = document.getElementById('toPlan');
    const reviewBtn = document.getElementById('reviewBtn');
    const summaryWrap = document.querySelector('[data-summary]');
    const summaryPlan = document.querySelector('[data-summary-plan]');
    const summaryPlanImage = summaryPlan.querySelector('[data-summary-plan-image]');
    const summaryPlanTitle = summaryPlan.querySelector('[data-summary-plan-title]');
    const summaryPlanPrice = summaryPlan.querySelector('[data-summary-plan-price]');
    const summaryPlanCopy = summaryPlan.querySelector('[data-summary-plan-copy]');
    const summaryPlanFeatures = summaryPlan.querySelector('[data-summary-plan-features]');
    const errorNotice = document.getElementById('formError');
    const formCardElement = document.querySelector('[data-form-card]');
    const completionState = document.querySelector('[data-complete-state]');
    const restartBtn = document.querySelector('[data-restart]');
    const recommendedPlanInput = document.getElementById('recommendedPlan');
    const planPriceInput = document.getElementById('planPrice');

    let currentStep = 0;

    const planCatalog = {
      '1-2': {
        name: 'Starter Plan',
        label: 'Starter Plan',
        price: '$39/mo · billed quarterly',
        description: 'Service for up to 2 cans with once-per-week set out and return. Perfect for smaller households and snowbirds.',
        features: [
          'Service for up to 2 cans',
          'Set out &amp; return once per week',
          'Extra bin add-on available'
        ],
        image: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20120%20120%22%20width%3D%22120%22%20height%3D%22120%22%3E%3Crect%20width%3D%22120%22%20height%3D%22120%22%20rx%3D%2228%22%20fill%3D%22%2322c55e%22/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2254%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2248%22%20font-weight%3D%22700%22%20fill%3D%22%23ffffff%22%3E2%3C/text%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2280%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2218%22%20font-weight%3D%22500%22%20fill%3D%22%23dcfce7%22%3EBins%3C/text%3E%3C/svg%3E'
      },
      '3-4': {
        name: 'Premium Plan',
        label: 'Premium Plan',
        price: '$54/mo · billed quarterly',
        description: 'Our most popular valet trash plan. Handles trash, recycle, and yard cans while giving you dashboard access.',
        features: [
          'Service for up to 4 cans',
          'All access to client dashboard',
          'Up to two collection days per week'
        ],
        image: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20120%20120%22%20width%3D%22120%22%20height%3D%22120%22%3E%3Crect%20width%3D%22120%22%20height%3D%22120%22%20rx%3D%2228%22%20fill%3D%22%230ea5e9%22/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2254%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2248%22%20font-weight%3D%22700%22%20fill%3D%22%23ffffff%22%3E4%3C/text%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2280%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2218%22%20font-weight%3D%22500%22%20fill%3D%22%23dcfce7%22%3EBins%3C/text%3E%3C/svg%3E'
      },
      '5-6': {
        name: 'Business Plan',
        label: 'Business Plan',
        price: '$65/mo · billed quarterly',
        description: 'White-glove valet trash for large homes and boutique commercial accounts that need dedicated support.',
        features: [
          'Service for up to 6 cans',
          'All Premium features +',
          'Dedicated account manager'
        ],
        image: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20120%20120%22%20width%3D%22120%22%20height%3D%22120%22%3E%3Crect%20width%3D%22120%22%20height%3D%22120%22%20rx%3D%2228%22%20fill%3D%22%23a855f7%22/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2254%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2248%22%20font-weight%3D%22700%22%20fill%3D%22%23ffffff%22%3E6%3C/text%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2280%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Poppins%2C%20Arial%2C%20sans-serif%22%20font-size%3D%2218%22%20font-weight%3D%22500%22%20fill%3D%22%23dcfce7%22%3EBins%3C/text%3E%3C/svg%3E'
      }
    };

    function updateProgress(){
      const percent = (currentStep / (steps.length - 1)) * 100;
      progressFill.style.width = `${percent}%`;
      progressItems.forEach((item, index)=>{
        item.classList.toggle('is-active', index <= currentStep);
      });
    }

    function updateRequirements(){
      steps.forEach((step, index)=>{
        const requiredFields = step.querySelectorAll('[data-step-required]');
        requiredFields.forEach(field=>{
          if(index === currentStep){
            field.setAttribute('required','');
            field.removeAttribute('aria-invalid');
          }else{
            field.removeAttribute('required');
          }
        });
      });
    }

    function showStep(index, options = {}){
      const { scrollToTop = true } = options;
      currentStep = index;
      steps.forEach((step, i)=>{
        const isActive = i === index;
        step.setAttribute('aria-hidden', String(!isActive));
        if(isActive){
          step.classList.add('is-active');
        }else{
          step.classList.remove('is-active');
        }
      });
      updateProgress();
      updateRequirements();
      if(index === 2){
        updatePlanCard();
      }
      if(index === 3){
        renderSummary();
      }
      if(scrollToTop){
        window.scrollTo({top:0, behavior:'smooth'});
      }
    }

    function validateStep(index){
      const step = steps[index];
      const requiredFields = Array.from(step.querySelectorAll('[data-step-required]'));
      const checkedRadios = new Set();
      for(const field of requiredFields){
        if(field.type === 'radio'){
          if(checkedRadios.has(field.name)) continue;
          checkedRadios.add(field.name);
          const groupChecked = planInputs.some(radio => radio.name === field.name && radio.checked);
          if(!groupChecked){
            field.setCustomValidity('Please pick the option that fits you best.');
            field.reportValidity();
            field.setCustomValidity('');
            return false;
          }
        }else{
          if(!field.checkValidity()){
            field.reportValidity();
            return false;
          }
        }
      }
      return true;
    }

    function nextStep(){
      if(!validateStep(currentStep)) return;
      if(currentStep < steps.length - 1){
        showStep(currentStep + 1);
      }
    }

    function prevStep(){
      if(currentStep > 0){
        showStep(currentStep - 1);
      }
    }

    form.querySelectorAll('[data-next]').forEach(btn=>{
      btn.addEventListener('click', nextStep);
    });
    form.querySelectorAll('[data-prev]').forEach(btn=>{
      btn.addEventListener('click', prevStep);
    });

    function updatePlanHighlights(){
      planInputs.forEach(input=>{
        const card = input.closest('.option-card');
        if(!card) return;
        card.classList.toggle('is-selected', input.checked);
      });
    }

    function updatePlanCard(){
      const selected = form.querySelector('input[name="bin_range"]:checked');
      if(!selected){
        planTitle.textContent = 'Choose how many bins you have first';
        planPrice.textContent = '';
        planCopy.textContent = 'Once you pick your bin count, we’ll show the BinPals package that keeps your cans sparkling on schedule.';
        planFeatures.innerHTML = '';
        planImage.hidden = true;
        reviewBtn.disabled = true;
        recommendedPlanInput.value = '';
        planPriceInput.value = '';
        return;
      }
      const plan = planCatalog[selected.value];
      if(!plan){
        reviewBtn.disabled = true;
        recommendedPlanInput.value = '';
        planPriceInput.value = '';
        return;
      }
      planTitle.textContent = plan.label;
      planPrice.textContent = plan.price;
      planCopy.innerHTML = plan.description;
      planFeatures.innerHTML = plan.features.map(item => `<li>${item}</li>`).join('');
      planImage.src = plan.image;
      planImage.alt = `${plan.name} icon`;
      planImage.hidden = false;
      reviewBtn.disabled = false;
      recommendedPlanInput.value = plan.name;
      planPriceInput.value = plan.price;
    }

    function renderSummary(){
      const selected = form.querySelector('input[name="bin_range"]:checked');
      const plan = selected ? planCatalog[selected.value] : null;
      const rows = [
        {label: 'Name', value: form.elements.name.value},
        {label: 'Email', value: form.elements.email.value},
        {label: 'Phone', value: form.elements.phone.value},
        {label: 'Service address', value: form.elements.address.value},
        {label: 'Bins requested', value: selected ? selected.value.replace('-', ' to ') + ' bins' : ''}
      ];
      summaryWrap.innerHTML = rows
        .filter(row => row.value)
        .map(row => `<div class="summary-row"><span>${row.label}</span><strong>${row.value}</strong></div>`)
        .join('');

      if(plan){
        summaryPlanTitle.textContent = plan.label;
        summaryPlanPrice.textContent = plan.price;
        summaryPlanCopy.innerHTML = plan.description;
        summaryPlanFeatures.innerHTML = plan.features.map(item => `<li>${item}</li>`).join('');
        summaryPlanImage.src = plan.image;
        summaryPlanImage.alt = `${plan.name} icon`;
        summaryPlanImage.hidden = false;
      }
    }

    planInputs.forEach(input=>{
      input.addEventListener('change', ()=>{
        updatePlanHighlights();
        updatePlanCard();
        planButtonStep2.disabled = !form.querySelector('input[name="bin_range"]:checked');
      });
    });

    showStep(0, {scrollToTop:false});
    updatePlanHighlights();

    function resetWizard(){
      form.reset();
      planButtonStep2.disabled = true;
      reviewBtn.disabled = true;
      showStep(0, {scrollToTop:false});
      updatePlanHighlights();
      updatePlanCard();
      errorNotice.classList.remove('show');
    }

    function showCompletion(){
      if(completionState){
        completionState.removeAttribute('hidden');
      }
      if(formCardElement){
        formCardElement.classList.add('is-complete');
        window.scrollTo({top:formCardElement.offsetTop - 40, behavior:'smooth'});
      }
    }

    function hideCompletion(){
      if(completionState){
        completionState.setAttribute('hidden','');
      }
      if(formCardElement){
        formCardElement.classList.remove('is-complete');
      }
    }

    restartBtn && restartBtn.addEventListener('click', ()=>{
      hideCompletion();
      resetWizard();
      const firstField = form.querySelector('input[name="name"]');
      firstField && firstField.focus();
    });

    form.addEventListener('submit', async (event)=>{
      event.preventDefault();
      errorNotice.classList.remove('show');

      if(!validateStep(3)){
        return;
      }

      const formData = new FormData(form);
      try{
        const response = await fetch('https://formspree.io/f/xgvpgrqg', {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: formData
        });

        if(response.ok){
          resetWizard();
          showCompletion();
        }else{
          errorNotice.classList.add('show');
        }
      }catch(error){
        console.error(error);
        errorNotice.classList.add('show');
      }
    });
  </script>
</body>
</html>
